(function(){function k(l){var m;if(!l&&typeof blq!=="undefined"&&blq.environment){l=blq.environment()}if(l==="sandbox"){if(document.cookie&&/demi-service-use-sandbox=1/.test(document.cookie)){m="http://pal.sandbox.dev.bbc.co.uk:8184"}else{l="test"}}if(!m){m="http://open."+(l||"live")+".bbc.co.uk"}return m+"/wurfldemi"}function f(n,l){var m=k(l);return m+"/useragent.jsonp?callback="+n+"&ua="+encodeURIComponent(navigator.userAgent)}function e(l){var m=k(l);return m+"/network.jsonp?callback={callback}"}function h(l){var m=(l||"").split(/x/);if(m.length===2){return[parseInt(m[0],10),parseInt(m[1],10)]}else{return null}}function d(l){this.data=l;this._display=h(l.display)}d.prototype={type:function(){return this.data.type!==""?this.data.type:null},isRecognised:function(){return this.data.type!==""},isDesktop:function(){return this.data.type==="desktop"},isMobile:function(){return this.data.type==="mobile"},isTV:function(){return this.data.type==="tv"},isTablet:function(){return this.data.type==="tablet"},wurflId:function(){return this.data.wurfl_id?this.data.wurfl_id:null},userAgent:function(){return this.data.user_agent?this.data.user_agent:null},brand:function(){return this.data.brand?this.data.brand:null},model:function(){return this.data.model?this.data.model:null},browser:function(){return this.data.browser?this.data.browser:null},os:function(){return this.data.os?this.data.os:null},osVersion:function(){return this.data.os_version?this.data.os_version:null},xhtmlLevel:function(){var l=this.data.xhtml_level;if(l){return parseInt(l,10)}else{return 0}},navigation:function(){return this.data.navigation?this.data.navigation:null},hasTouchscreen:function(){return this.data.navigation==="touchscreen"},hasStylus:function(){return this.data.navigation==="stylus"},hasJoystick:function(){return this.data.navigation==="joystick"},hasClickwheel:function(){return this.data.navigation==="clickwheel"},hasMouse:function(){return this.data.navigation==="mouse"},display:function(){return this._display},displayWidth:function(){return this._display?this._display[0]:null},displayHeight:function(){return this._display?this._display[1]:null},streamingMp4:function(){return this.data.streaming_mp4==="true"},streaming3gpp:function(){return this.data.streaming_3gpp==="true"},mp3:function(){return this.data.mp3==="true"}};function j(l){return{version:function(){return l.version},isMobile:function(){return(l.is_mobile_network===undefined||this.error())?null:l.is_mobile_network},error:function(){if(l&&l.is_mobile_network_error){return new Error("error getting network data: "+l.is_mobile_network_error)}else{if(l&&l.is_mobile_network===undefined){return new Error("could not determine network")}}return null}}}function i(m){for(var l=0;(m+l) in this;l++){}return m+l}if(typeof define!=="undefined"){var c=this;define([f("define")],function(n){var l={},m=[],p=null,o=i("_demi_mobile_network_cb_");l._addScriptTag=function(t,s){var r=document.getElementsByTagName("head")[0],q=document.createElement("script");p=function(){r.removeChild(q)};q.type="text/javascript";q.src=t.replace(/{callback}/,s);r.insertBefore(q,r.firstChild)};c[o]=function(q){l._runCallbacks(q);p();p=null};l.device=new d(n);l.getNetwork=function(s){m.push(s);if(!p){if(navigator.connection&&navigator.connection.type!=navigator.connection.UNKNOWN){var q=navigator.connection.type,r={};r.is_mobile_network=(q==navigator.connection.CELL_3G||q==navigator.connection.CELL_2G);r.is_mobile_network_error=false;r.version="navigator";l._runCallbacks(r)}else{l._addScriptTag(e(),o)}}};l._runCallbacks=function(s){var r=new j(s),q=r.error();while(m.length>0){m.pop()(q,r)}};return l})}if(typeof demi!=="undefined"){var g=[],a=[],b=null;demi._addScriptTag=function(n){var l=document.getElementsByTagName("head")[0];var m=document.createElement("script");m.type="text/javascript";m.src=n;l.insertBefore(m,l.firstChild)};demi._receiveDevice=function(m){b=new d(m);var l=!b.isRecognised();while(g.length>0){g.pop()(l,b)}return b};demi.getDevice=function(m,l){if(b!==null){m(!b.isRecognised(),b)}else{if(g.length>0){g.push(m)}else{g.push(m);demi._addScriptTag(f("demi._receiveDevice",l))}}};if(demi._loaded){demi._loaded()}}})();